version: '3.8'

services:
  # Nuxt Development Server
  construction-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: construction-dev
    ports:
      - "${APP_PORT:-3000}:${NUXT_PORT:-3000}"
      - "24678:24678" # Nuxt DevTools
    environment:
      - NODE_ENV=development
      - NUXT_PORT=${NUXT_PORT:-3000}
      - NUXT_HOST=${NUXT_HOST:-0.0.0.0}
      - NUXT_DB_PATH=/app/data/construction.db
      - NUXT_PUBLIC_API_BASE=/api
      - NUXT_JWT_SECRET=${JWT_SECRET:-dev-jwt-secret}
      - NUXT_SESSION_SECRET=${SESSION_SECRET:-dev-session-secret}
      - NUXT_ADMIN_EMAIL=${ADMIN_EMAIL:-admin@construction.local}
      - NUXT_ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123}
    volumes:
      # Mount source code for hot reload
      - .:/app
      - /app/node_modules
      # Mount database directory
      - ./data/sqlite:/app/data
      # Mount uploads directory
      - ./data/uploads:/app/uploads
    networks:
      - construction-network
    restart: unless-stopped
    command: ["npm", "run", "dev"]

  # SQLite Admin for Development
  sqlite-web-dev:
    image: coleifer/sqlite-web
    container_name: construction-sqlite-dev
    ports:
      - "${SQLITE_ADMIN_PORT:-8080}:8080"
    volumes:
      - ./data/sqlite:/data
    command: ["sqlite-web", "-H", "0.0.0.0", "-p", "8080", "/data/construction.db"]
    networks:
      - construction-network
    restart: unless-stopped

networks:
  construction-network:
    driver: bridge